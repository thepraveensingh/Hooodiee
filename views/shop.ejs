<%- include('./partials/header') %>

<% if (success.length > 0) { %>
    <div class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-blue-500">
        <span class="inline-block mt-1 mb-1 text-white">
            <%= success %>
        </span>
    </div>
<% } %>

<div class="w-full h-screen flex items-start px-20 py-20 ">
    <div class="w-[25%] flex h-screen flex-col items-start ">
        <div class="flex items-center gap-2">
            <h3>Sort by</h3>
            <form action="<%= BASE_URL %>/shop">
                <select class="border-[1px] px-2 py-1" name="sortby" id="">
                    <option value="popular">Popular</option>
                    <option value="newest">Newest</option>
                </select>
            </form>
        </div>

        <div class="flex flex-col mt-20">
            <a class="block w-fit mb-2 <% if (filter === 'all') { %> font-bold text-black <% } else { %> text-gray-500 <% } %>"
                href="<%= BASE_URL %>/shop?filter=all">All Products</a>
            <a class="block w-fit mb-2 <% if (filter === 'new') { %> font-bold text-black <% } else { %> text-gray-500 <% } %>"
                href="<%= BASE_URL %>/shop?filter=new">New Collection</a>
            <a class="block w-fit mb-2 <% if (filter === 'discount') { %> font-bold text-black <% } else { %> text-gray-500 <% } %>"
                href="<%= BASE_URL %>/shop?filter=discount">Discounted Products</a>
        </div>

        <!-- Discount Filter Dropdown -->
        <div class="mt-32">
            <form action="<%= BASE_URL %>/shop" method="GET">
                <label for="discount">Filter by Discount:</label>
                <select name="discount" id="discount" class="border-[1px] px-2 py-1">
                    <option value="">Select Discount</option>
                    <option value="20">20% OFF</option>
                    <option value="40">40% OFF</option>
                    <option value="60">60% OFF</option>
                </select>
                <button type="submit" class="mt-2 px-4 py-1 bg-black text-white rounded-md">Apply</button>
            </form>
        </div>
    </div>

    <div class="w-[75%] flex flex-col h-screen items-end">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5">
            <% products.forEach((product) => {
                const showProduct = (filter === 'all' || (filter === 'new') || (filter === 'discount') || (filter === 'discounted'));
                if (showProduct) {
                    const netTotal = product.price - product.discount;
                    const discountPercentage = ((product.discount / product.price) * 100).toFixed(0); // Calculate discount %
            %>
            <div class="w-full flex flex-col bg-white rounded-lg shadow-md overflow-hidden pb-0 ">
                <div class="w-full flex items-center bg-[<%= product.bgColor %>] h-full ">
                    <img class="h-full w-full object-cover"
                        src="data:image/jpeg;base64,<%= product.image.toString('base64') %> " alt="">
                </div>
                <div class="flex h-1/3 bg-[<%= product.panelColor %>] justify-between items-start text-[<%= product.textColor %>] px-4 py-4">
                    <div>
                        <h3>
                            <%= product.name %>
                        </h3>
                        <h4>â‚¹<%= product.price - product.discount %>
                            <% if (discountPercentage > 0) { %>
                                <span class="text-red-500">( <%= discountPercentage %>% OFF )</span>
                        </h4>
                        <% } %>
                    </div>
                    <a class="w-7 h-7 flex items-center justify-center rounded-full bg-white"
                        href="<%= BASE_URL %>/addToCart/<%= product._id %>">
                        <i class="ri-add-line"></i>
                    </a>
                </div>
            </div>
            <% } }) %>
        </div>
    </div>
</div>
